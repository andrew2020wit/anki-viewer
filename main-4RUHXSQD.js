import{a as G,g as Y,h as q}from"./chunk-P3T3RLCI.js";import"./chunk-5K5SMW74.js";import{Ca as W,D as v,F as P,G as l,H as a,I as F,Q as V,T as j,a as A,bb as _,c as R,cb as K,e as C,f as T,j as m,ja as L,k as U,m as D,o as u,p as O,pb as B,qa as x,ra as w,rb as H,s as d,sb as $,u as N,ub as Z,xb as z,y as g}from"./chunk-BQGAW33D.js";var ne="2.2.1";function b(r){return r+" v"+ne}var J=[{path:"viewer",title:b("Anki Viewer"),loadComponent:()=>import("./chunk-3OB3CSFU.js").then(r=>r.ViewerComponent)},{path:"learn",title:b("Anki Learn"),loadComponent:()=>import("./chunk-5YV32OFK.js").then(r=>r.LearnComponent)},{path:"settings",title:b("Settings"),loadComponent:()=>import("./chunk-BVLLAFTE.js").then(r=>r.SettingsComponent)},{path:"",pathMatch:"full",title:b("Anki Viewer"),loadComponent:()=>import("./chunk-JWQNGX7L.js").then(r=>r.HomeComponent)}];var E="Service workers are disabled or not supported by this browser",h=class{serviceWorker;worker;registration;events;constructor(t,e){if(this.serviceWorker=t,!t)this.worker=this.events=this.registration=new C(o=>o.error(new Error(E)));else{let o=null,n=new T;this.worker=new C(p=>(o!==null&&p.next(o),n.subscribe(S=>p.next(S))));let s=()=>{let{controller:p}=t;p!==null&&(o=p,n.next(o))};t.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(g(()=>t.getRegistration()));let i=new T;this.events=i.asObservable();let c=p=>{let{data:S}=p;S?.type&&i.next(S)};t.addEventListener("message",c),e?.get(w,null,{optional:!0})?.onDestroy(()=>{t.removeEventListener("controllerchange",s),t.removeEventListener("message",c)})}}postMessage(t,e){return new Promise(o=>{this.worker.pipe(d(1)).subscribe(n=>{n.postMessage(A({action:t},e)),o()})})}postMessageWithOperation(t,e,o){let n=this.waitForOperationCompleted(o),s=this.postMessage(t,e);return Promise.all([s,n]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(t){let e;return typeof t=="string"?e=o=>o.type===t:e=o=>t.includes(o.type),this.events.pipe(O(e))}nextEventOfType(t){return this.eventsOfType(t).pipe(d(1))}waitForOperationCompleted(t){return new Promise((e,o)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(O(n=>n.nonce===t),d(1),m(n=>{if(n.result!==void 0)return n.result;throw new Error(n.error)})).subscribe({next:e,error:o})})}get isEnabled(){return!!this.serviceWorker}},oe=(()=>{class r{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new T;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=u,this.notificationClicks=u,this.subscription=u;return}this.messages=this.sw.eventsOfType("PUSH").pipe(m(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(m(n=>n.data)),this.pushManager=this.sw.registration.pipe(m(n=>n.pushManager));let o=this.pushManager.pipe(g(n=>n.getSubscription()));this.subscription=new C(n=>{let s=o.subscribe(n),i=this.subscriptionChanges.subscribe(n);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(E));let o={userVisibleOnly:!0},n=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(n.length));for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return o.applicationServerKey=s,new Promise((i,c)=>{this.pushManager.pipe(g(f=>f.subscribe(o)),d(1)).subscribe({next:f=>{this.subscriptionChanges.next(f),i(f)},error:c})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(E));let e=o=>{if(o===null)throw new Error("Not subscribed to push notifications.");return o.unsubscribe().then(n=>{if(!n)throw new Error("Unsubscribe failed!");this.subscriptionChanges.next(null)})};return new Promise((o,n)=>{this.subscription.pipe(d(1),g(e)).subscribe({next:o,error:n})})}decodeBase64(e){return atob(e)}static \u0275fac=function(o){return new(o||r)(l(h))};static \u0275prov=v({token:r,factory:r.\u0275fac})}return r})(),M=(()=>{class r{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=u,this.unrecoverable=u;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(E));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(E));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(o){return new(o||r)(l(h))};static \u0275prov=v({token:r,factory:r.\u0275fac})}return r})();var ee=new P("");function ie(){let r=a(y);if(!("serviceWorker"in navigator&&r.enabled!==!1))return;let t=a(ee),e=a(j),o=a(w);e.runOutsideAngular(()=>{let n=navigator.serviceWorker,s=()=>n.controller?.postMessage({action:"INITIALIZE"});n.addEventListener("controllerchange",s),o.onDestroy(()=>{n.removeEventListener("controllerchange",s)})}),e.runOutsideAngular(()=>{let n,{registrationStrategy:s}=r;if(typeof s=="function")n=new Promise(i=>s().subscribe(()=>i()));else{let[i,...c]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":n=Promise.resolve();break;case"registerWithDelay":n=Q(+c[0]||0);break;case"registerWhenStable":n=Promise.race([o.whenStable(),Q(+c[0])]);break;default:throw new Error(`Unknown ServiceWorker registration strategy: ${r.registrationStrategy}`)}}n.then(()=>navigator.serviceWorker.register(t,{scope:r.scope}).catch(i=>console.error("Service worker registration failed with:",i)))})}function Q(r){return new Promise(t=>setTimeout(t,r))}function se(r,t){return new h(r.enabled!==!1?navigator.serviceWorker:void 0,t)}var y=class{enabled;scope;registrationStrategy};function te(r,t={}){return F([oe,M,{provide:ee,useValue:r},{provide:y,useValue:t},{provide:h,useFactory:se,deps:[y,V]},x(ie)])}var re={providers:[_({eventCoalescing:!0}),z(J),Y,H($()),te("ngsw-worker.js",{enabled:!K(),registrationStrategy:"registerWhenStable:30000"})]};var k=class r{constructor(t,e,o){this.swUpdate=t;this.appRef=e;this.info=o}isTestMode=!1;init(){if(this.isTestMode&&console.log("test v 6"),!this.swUpdate.isEnabled){console.warn("!this.swUpdate.isEnabled");return}this.subscribeToVersionUpdates(),this.checkForUpdate()}subscribeToVersionUpdates(){this.swUpdate.versionUpdates.subscribe(t=>{switch(t.type){case"VERSION_DETECTED":console.log(`new version is detected on the server: ${t.version.hash}`);break;case"VERSION_READY":console.log("new version has been downloaded and is ready for activation"),console.log(`Current app version: ${t.currentVersion.hash}`),console.log(`New app version ready for use: ${t.latestVersion.hash}`),this.info.show("New version is available! Reload page.");break;case"VERSION_INSTALLATION_FAILED":console.log(`checking for or downloading a new version fails '${t.version.hash}': ${t.error}`);break}}),this.swUpdate.unrecoverable.subscribe(t=>{let e=`An error occurred that we cannot recover from:
`+t.reason+`
 Please reload the page.`;this.info.error(e),console.error(e)})}checkForUpdate(){let t=this.appRef.isStable.pipe(N(e=>e===!0));U(t,D(this.isTestMode?2e3:36e5)).subscribe(()=>R(this,null,function*(){try{let e=yield this.swUpdate.checkForUpdate();console.log(e?"checkForUpdate: a new version was found and is ready to be activated":"checkForUpdate: no new version was found. ")}catch(e){console.error("checkForUpdate: Failed to check for updates:",e)}}))}static \u0275fac=function(e){return new(e||r)(l(M),l(w),l(q))};static \u0275prov=v({token:r,factory:r.\u0275fac,providedIn:"root"})};var I=class r{hotKeysService=a(G);pwaToolService=a(k);ngOnInit(){this.pwaToolService.init(),this.setHotKeys()}setHotKeys(){window.document.addEventListener("keydown",t=>{this.hotKeysService.hotKeyEvent.next(t.key.toLowerCase())})}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=L({type:r,selectors:[["app-root"]],decls:1,vars:0,template:function(e,o){e&1&&W(0,"router-outlet")},dependencies:[Z],encapsulation:2})};B(I,re).catch(r=>console.error(r));
