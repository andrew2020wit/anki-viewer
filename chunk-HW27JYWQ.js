import{a as B}from"./chunk-BUG2RXMT.js";import{c as D,d as q,f as V}from"./chunk-5YMQPX37.js";import"./chunk-6TPRDAXS.js";import{a as U,b as j}from"./chunk-R5FB43CF.js";import"./chunk-5H7V54M7.js";import"./chunk-WIZ6UHY7.js";import{a as N}from"./chunk-5K5SMW74.js";import{Ca as s,Da as r,Ea as C,I,Ia as v,Sa as d,Ua as u,Va as A,Y as g,ab as R,bb as K,da as _,ea as t,ia as H,ma as T,ra as y,s as E,u as L,va as f,wa as h,wb as z,ya as x}from"./chunk-U47C5U2E.js";var F=(i,l)=>i.type!==l.type?i.type-l.type:i.due-l.due;var G={ShowExtraInfo:[" "],LearnAgain:["1"],SetHard:["2"],SetNormal:["3","enter"],SetEasy:["4"],ReplayAudio:["r","\u043A"]};function k(i,l){return G[i].includes(l)}function J(i,l){if(i&1&&(s(0,"div",0)(1,"a",5),d(2," Viewer "),r(),C(3,"br")(4,"br"),r()),i&2){let e=v();t(),f("routerLink","/"+e.UrlsEnum.Viewer)}}function Q(i,l){if(i&1&&(s(0,"span",16),d(1),r()),i&2){let e,n=v(3);t(),u(" ",(e=n.ankiCard())==null||e.fields==null||e.fields.phVerb==null?null:e.fields.phVerb.value," ")}}function W(i,l){if(i&1&&C(0,"span",17),i&2){let e,n=v(3);f("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.lexunit==null?null:e.fields.lexunit.value,_)}}function X(i,l){if(i&1&&(s(0,"div",12),y(1,Q,2,1,"span",16)(2,W,1,1,"span",17),r()),i&2){let e,n,o=v(2);t(),x(!((e=o.ankiCard())==null||e.fields==null||e.fields.phVerb==null)&&e.fields.phVerb.value?1:-1),t(),x(!((n=o.ankiCard())==null||n.fields==null||n.fields.lexunit==null)&&n.fields.lexunit.value?2:-1)}}function Y(i,l){if(i&1&&C(0,"div",22),i&2){let e,n=v(3);f("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.translation==null?null:e.fields.translation.value,_)}}function Z(i,l){if(i&1&&(s(0,"div",18),C(1,"span",19),R(2,"transcription"),s(3,"span",20)(4,"span"),d(5),r(),s(6,"span"),d(7),r()()(),C(8,"div",21),y(9,Y,1,1,"div",22)),i&2){let e,n,o,p,m,c=v(2);t(),f("innerHTML",K(2,5,(e=c.ankiCard())==null||e.fields==null||e.fields.transcription==null?null:e.fields.transcription.value),_),t(4),u(" ",(n=c.ankiCard())==null||n.fields==null||n.fields.freq==null?null:n.fields.freq.value," "),t(2),u(" ",(o=c.ankiCard())==null||o.fields==null||o.fields.freq2==null?null:o.fields.freq2.value," "),t(),f("innerHTML",(p=c.ankiCard())==null||p.fields==null||p.fields.def==null?null:p.fields.def.value,_),t(),x(!((m=c.ankiCard())==null||m.fields==null||m.fields.translation==null)&&m.fields.translation.value?9:-1)}}function ee(i,l){if(i&1&&(s(0,"div",1)(1,"div",6)(2,"span",7),d(3),r(),s(4,"span",8),d(5),r(),C(6,"span",9),s(7,"span",10),d(8),r(),C(9,"span",11),y(10,X,3,2,"div",12),r(),C(11,"div",13),y(12,Z,10,7),s(13,"div",14)(14,"span"),d(15),r(),s(16,"span"),d(17),r(),s(18,"span",15),d(19),r(),s(20,"span"),d(21),r()()()),i&2){let e,n,o,p,m,c,b,O,S,M,w,P,a=v();t(3),A(" ",a.learningCardsNumber()," : ",a.cardsNumber()," "),t(),h("review",a.ankiCardTypes[((e=a.ankiCard())==null?null:e.type)||9]==="review"),t(),u(" ",a.ankiCardTypes[((n=a.ankiCard())==null?null:n.type)||9]," : "),t(),f("innerHTML",(o=a.ankiCard())==null||o.fields==null||o.fields.term==null?null:o.fields.term.value,_),t(2),u(" (",(p=a.ankiCard())==null||p.fields==null||p.fields.pos==null?null:p.fields.pos.value,") "),t(),f("innerHTML",(m=a.ankiCard())==null||m.fields==null||m.fields.registerlab==null?null:m.fields.registerlab.value,_),t(),x(!((c=a.ankiCard())==null||c.fields==null||c.fields.phVerb==null)&&c.fields.phVerb.value||!((c=a.ankiCard())==null||c.fields==null||c.fields.lexunit==null)&&c.fields.lexunit.value?10:-1),t(),f("innerHTML",(b=a.ankiCard())==null||b.fields==null||b.fields.exampleText==null?null:b.fields.exampleText.value,_),t(),x(a.showBackSide()?12:-1),t(),h("review",a.ankiCardTypes[((O=a.ankiCard())==null?null:O.type)||9]==="review"),t(),h("was-last",a.lastAnswer()===1),t(),u("",(S=a.ankiCard())==null||S.nextReviews==null?null:S.nextReviews[0]," "),t(),h("was-last",a.lastAnswer()===2),t(),u("",(M=a.ankiCard())==null||M.nextReviews==null?null:M.nextReviews[1]," "),t(),h("was-last",a.lastAnswer()===3),t(),u("",(w=a.ankiCard())==null||w.nextReviews==null?null:w.nextReviews[2]," "),t(),h("was-last",a.lastAnswer()===4),t(),u("",(P=a.ankiCard())==null||P.nextReviews==null?null:P.nextReviews[3]," ")}}var $=class i{constructor(l){this.ankiConnectService=l}isLoading=g(!1);ankiCard=g(null);cardsNumber=g(0);learningCardsNumber=g(0);showBackSide=g(!0);lastAnswer=g(0);UrlsEnum=N;ankiCardTypes=D;hotKeysService=I(B);hotKeysServiceSubscription;htmLAudioElement=null;ngOnInit(){this.getCard(),this.takeHotKey()}ngOnDestroy(){this.hotKeysServiceSubscription?.unsubscribe()}getCard(){let e=`deck:${localStorage.getItem(j.key)||"cald"} is:due`;this.isLoading.set(!0),this.showBackSide.set(!1),this.ankiConnectService.findCards(e).pipe(E(1),L(()=>{this.isLoading.set(!1)})).subscribe(n=>{console.log(n.slice(0,50)),n.sort(F),this.ankiCard.set(n[0]||null),this.cardsNumber.set(n.length),this.learningCardsNumber.set(n.filter(o=>o.type===1).length),window.scrollTo(0,0),this.initAudio()})}takeHotKey(){this.hotKeysServiceSubscription=this.hotKeysService.hotKeyEvent.subscribe(l=>{switch(!0){case k("ShowExtraInfo",l):this.showBackSide.set(!0),this.replayAudio();break;case k("LearnAgain",l):this.answerCard(1);break;case k("SetHard",l):this.answerCard(2);break;case k("SetNormal",l):this.answerCard(3);break;case k("SetEasy",l):this.answerCard(4);break;case k("ReplayAudio",l):this.replayAudio();break}})}answerCard(l){this.isLoading.set(!0);let e=this.ankiCard()?.cardId;e&&this.ankiConnectService.answerCardsByIds([e],l).pipe(E(1),L(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.lastAnswer.set(l),this.getCard()})}initAudio(){let l=this.ankiCard()?.fields?.sound?.value;if(this.htmLAudioElement=null,!l)return;let e=l.replaceAll("[sound:","").replaceAll("]","").trim(),n=localStorage.getItem(U.key);!e||!n||(this.htmLAudioElement=new Audio(n+e),this.htmLAudioElement.play())}replayAudio(){this.htmLAudioElement?.play()}static \u0275fac=function(e){return new(e||i)(H(V))};static \u0275cmp=T({type:i,selectors:[["app-learn"]],decls:9,vars:3,consts:[[1,"empty-block"],[1,"card"],[1,"settings"],["routerLink","/"],[1,"hints"],[3,"routerLink"],[1,"term-block"],[1,"cards-number"],[1,"card-type"],[1,"term",3,"innerHTML"],[1,"pos"],[1,"register-lab",3,"innerHTML"],[1,"lex-unit"],[1,"example",3,"innerHTML"],[1,"next-reviews"],[1,"normal"],[1,"ph-verb"],[1,"lex-unit",3,"innerHTML"],[1,"term-extra"],[1,"transcription",3,"innerHTML"],[1,"freq"],[1,"definition",3,"innerHTML"],[1,"translation",3,"innerHTML"]],template:function(e,n){if(e&1&&(y(0,J,5,1,"div",0)(1,ee,22,25,"div",1),s(2,"div",2)(3,"a",3),d(4," Home "),r(),s(5,"span"),d(6),r(),s(7,"span",4),d(8," | Space - show extra, 1-again, 2-hard, 3 (or enter) -normal, 4-ease. R - replay sound. "),r()()),e&2){let o;x(n.ankiCard()?-1:0),t(),x(n.ankiCard()?1:-1),t(5),u(" Deck: ",(o=n.ankiCard())==null?null:o.deckName," ")}},dependencies:[z,q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;margin:0 auto;max-width:800px;padding:24px;height:100%;box-sizing:border-box}.settings[_ngcontent-%COMP%]{align-items:center;display:flex;gap:8px;justify-content:start;margin-bottom:24px}.card[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;align-items:center;justify-content:flex-start;gap:16px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]{display:flex;font-size:24px;gap:16px;align-items:baseline}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type[_ngcontent-%COMP%]{font-size:14px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type.review[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]{color:#00f}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .pos[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{font-size:24px;color:#00f}.card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{color:#8b0000}.card[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{font-size:24px}.card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:24px;padding:4px 8px;border:1px solid gray}.next-reviews.review[_ngcontent-%COMP%]{border:1px solid darkred;outline:1px solid darkred}.next-reviews[_ngcontent-%COMP%]   .normal[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]   .was-last[_ngcontent-%COMP%]{text-decoration:underline}.ph-verb[_ngcontent-%COMP%]{color:#00008b}.lex-unit[_ngcontent-%COMP%]{color:#8b0000}.cards-number[_ngcontent-%COMP%]{color:#8b008b}"]})};export{$ as LearnComponent};
