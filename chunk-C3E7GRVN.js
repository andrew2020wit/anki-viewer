import{c as q,d as K,e as j,f as F,g as h,h as $}from"./chunk-H4IECQBB.js";import{a as Q}from"./chunk-POCYZ5R7.js";import{m as V,n as U}from"./chunk-GWILJIGV.js";import"./chunk-LQSYGPAI.js";import{a as B}from"./chunk-5K5SMW74.js";import{Ba as m,Bb as R,Ca as M,Db as D,Ea as k,Eb as z,Ha as r,Ia as a,Ja as C,M as T,Na as b,Xa as s,Za as u,_a as A,ba as _,fb as H,gb as N,ia as g,ja as i,na as P,ra as I,v as y,wa as S,x as w}from"./chunk-Q4LM43N5.js";var E="cald";function J(l,t){if(l&1&&(r(0,"div",0)(1,"a",5),s(2," Viewer "),a(),C(3,"br")(4,"br"),a()),l&2){let e=b();i(),m("routerLink","/"+e.UrlsEnum.Viewer)}}function W(l,t){if(l&1&&(r(0,"span",18),s(1),a()),l&2){let e,n=b(3);i(),u(" ",(e=n.ankiCard())==null||e.fields==null||e.fields.phVerb==null?null:e.fields.phVerb.value," ")}}function X(l,t){if(l&1&&C(0,"span",19),l&2){let e,n=b(3);m("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.lexunit==null?null:e.fields.lexunit.value,g)}}function Y(l,t){if(l&1&&(r(0,"div",16),S(1,W,2,1,"span",18)(2,X,1,1,"span",19),a()),l&2){let e,n,d=b(2);i(),k(!((e=d.ankiCard())==null||e.fields==null||e.fields.phVerb==null)&&e.fields.phVerb.value?1:-1),i(),k(!((n=d.ankiCard())==null||n.fields==null||n.fields.lexunit==null)&&n.fields.lexunit.value?2:-1)}}function Z(l,t){if(l&1&&C(0,"div",24),l&2){let e,n=b(3);m("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.translation==null?null:e.fields.translation.value,g)}}function ee(l,t){if(l&1&&(r(0,"div",20),C(1,"span",21),H(2,"transcription"),r(3,"span",22)(4,"span"),s(5),a(),r(6,"span"),s(7),a()()(),C(8,"div",23),S(9,Z,1,1,"div",24),r(10,"div",25)(11,"span"),s(12),a(),r(13,"span"),s(14),a(),r(15,"span",26),s(16),a(),r(17,"span"),s(18),a()()),l&2){let e,n,d,f,v,p,x,o,L,O,c=b(2);i(),m("innerHTML",N(2,19,(e=c.ankiCard())==null||e.fields==null||e.fields.transcription==null?null:e.fields.transcription.value),g),i(4),u(" ",(n=c.ankiCard())==null||n.fields==null||n.fields.freq==null?null:n.fields.freq.value," "),i(2),u(" ",(d=c.ankiCard())==null||d.fields==null||d.fields.freq2==null?null:d.fields.freq2.value," "),i(),m("innerHTML",(f=c.ankiCard())==null||f.fields==null||f.fields.def==null?null:f.fields.def.value,g),i(),k(!((v=c.ankiCard())==null||v.fields==null||v.fields.translation==null)&&v.fields.translation.value?9:-1),i(),M("review",c.ankiCardTypes[((p=c.ankiCard())==null?null:p.type)||9]==="review"),i(),M("was-last",c.lastAnswer()===1),i(),u("",(x=c.ankiCard())==null||x.nextReviews==null?null:x.nextReviews[0]," "),i(),M("was-last",c.lastAnswer()===2),i(),u("",(o=c.ankiCard())==null||o.nextReviews==null?null:o.nextReviews[1]," "),i(),M("was-last",c.lastAnswer()===3),i(),u("",(L=c.ankiCard())==null||L.nextReviews==null?null:L.nextReviews[2]," "),i(),M("was-last",c.lastAnswer()===4),i(),u("",(O=c.ankiCard())==null||O.nextReviews==null?null:O.nextReviews[3]," ")}}function te(l,t){if(l&1&&(r(0,"div",1)(1,"div",7)(2,"span",8)(3,"span",9),s(4),a(),r(5,"span",10),s(6),a()(),r(7,"span",11),s(8),a(),r(9,"span",12),s(10),a(),C(11,"span",13),r(12,"span",14),s(13),a(),C(14,"span",15),S(15,Y,3,2,"div",16),a(),C(16,"div",17),S(17,ee,19,21),a()),l&2){let e,n,d,f,v,p,x,o=b();i(4),u(" ",o.timerCounter()," "),i(2),u(" ",o.timerTimeMin()," "),i(2),A(" ",o.learningCardsNumber()," : ",o.cardsNumber()," "),i(),M("review",o.ankiCardTypes[((e=o.ankiCard())==null?null:e.type)||9]==="review"),i(),u(" ",o.ankiCardTypes[((n=o.ankiCard())==null?null:n.type)||9]," : "),i(),m("innerHTML",(d=o.ankiCard())==null||d.fields==null||d.fields.term==null?null:d.fields.term.value,g),i(2),u(" (",(f=o.ankiCard())==null||f.fields==null||f.fields.pos==null?null:f.fields.pos.value,") "),i(),m("innerHTML",(v=o.ankiCard())==null||v.fields==null||v.fields.registerlab==null?null:v.fields.registerlab.value,g),i(),k(!((p=o.ankiCard())==null||p.fields==null||p.fields.phVerb==null)&&p.fields.phVerb.value||!((p=o.ankiCard())==null||p.fields==null||p.fields.lexunit==null)&&p.fields.lexunit.value?15:-1),i(),m("innerHTML",(x=o.ankiCard())==null||x.fields==null||x.fields.exampleText==null?null:x.fields.exampleText.value,g),i(),k(o.showBackSide()?17:-1)}}var G=class l{constructor(t,e,n){this.ankiConnectService=t;this.activatedRoute=e;this.router=n}isLoading=_(!1);ankiCard=_(null);cardsNumber=_(0);learningCardsNumber=_(0);showBackSide=_(!0);lastAnswer=_(0);timerCounter=_(0);timerTimeMin=_(0);UrlsEnum=B;ankiCardTypes=q;timerBaseTimeMs=Date.now();hotKeysService=T(Q);hotKeysServiceSubscription;htmLAudioElement=null;lastCardId=0;deckName=E;ngOnInit(){this.checkDeckName(),this.getCard(),this.takeHotKey()}ngOnDestroy(){this.hotKeysServiceSubscription?.unsubscribe(),this.htmLAudioElement?.pause(),this.htmLAudioElement?.remove()}replayAudio(){this.htmLAudioElement&&(this.htmLAudioElement.currentTime=0),this.htmLAudioElement?.play()}getCard(){let t=`deck:${this.deckName} is:due`;this.isLoading.set(!0),this.showBackSide.set(!1),this.ankiConnectService.findCards(t).pipe(y(1),w(()=>{this.isLoading.set(!1)})).subscribe(e=>{this.stopAudio(),e.sort(F),this.ankiCard.set(e[0]||null),this.cardsNumber.set(e.length),this.learningCardsNumber.set(e.filter(n=>n.type===1).length),window.scrollTo(0,0),this.initAudio()})}getCardById(t){t&&(this.isLoading.set(!0),this.showBackSide.set(!1),this.ankiConnectService.getCardById(t).pipe(y(1),w(()=>{this.isLoading.set(!1)})).subscribe(e=>{this.stopAudio(),this.ankiCard.set(e||null),this.cardsNumber.set(0),this.learningCardsNumber.set(0),window.scrollTo(0,0),this.initAudio()}))}takeHotKey(){this.hotKeysServiceSubscription=this.hotKeysService.hotKeyEvent.subscribe(t=>{switch(!0){case h("ShowExtraInfo",t):this.showBackSide.set(!0),this.replayAudio();break;case h("LearnAgain",t):this.answerCard(1);break;case h("SetHard",t):this.answerCard(2);break;case h("SetNormal",t):this.answerCard(3);break;case h("SetEasy",t):this.answerCard(4);break;case h("ReplayAudio",t):this.replayAudio();break;case h("RestoreLastCard",t):this.restoreLastCard();break;case h("ForgetCard",t):this.forgetCard();break}})}forgetCard(){if(!this.showBackSide())return;this.isLoading.set(!0);let t=this.ankiCard()?.cardId;t&&this.ankiConnectService.forgetCard(t).pipe(y(1),w(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.lastAnswer.set(0),this.increaseTimer(),this.getCard()})}answerCard(t){if(!this.showBackSide())return;this.isLoading.set(!0);let e=this.ankiCard()?.cardId;e&&this.ankiConnectService.answerCardsByIds([e],t).pipe(y(1),w(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.lastCardId=e,this.increaseTimer(),this.lastAnswer.set(t),this.getCard()})}initAudio(){let t=this.ankiCard()?.fields?.sound?.value;if(this.htmLAudioElement=null,!t)return;let e=j(t),n=localStorage.getItem(V.key);!e||!n||(this.htmLAudioElement=new Audio(n+e),this.htmLAudioElement.play())}stopAudio(){this.htmLAudioElement?.pause()}increaseTimer(){this.timerCounter.update(n=>n+1);let t=Math.round((Date.now()-this.timerBaseTimeMs)/1e3),e=Math.floor(t/60);this.timerTimeMin.set(e)}restoreLastCard(){this.lastCardId&&this.ankiConnectService.answerCardsByIds([this.lastCardId],1).pipe(y(1),w(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.getCardById(this.lastCardId)})}checkDeckName(){let t=this.activatedRoute.snapshot.queryParams.deck,e=localStorage.getItem(U.key),n=t||e||E;t||this.router.navigate([],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",queryParams:{deck:n}}),this.deckName=n}static \u0275fac=function(e){return new(e||l)(P($),P(R),P(D))};static \u0275cmp=I({type:l,selectors:[["app-learn"]],decls:14,vars:4,consts:[[1,"empty-block"],[1,"card"],[1,"bottom"],[1,"bottom-line"],["routerLink","/"],[3,"routerLink"],[1,"hints"],[1,"term-block"],[1,"timer-block"],[1,"timer-counter"],[1,"timer-value"],[1,"cards-number"],[1,"card-type"],[1,"term",3,"innerHTML"],[1,"pos"],[1,"register-lab",3,"innerHTML"],[1,"lex-unit"],[1,"example",3,"innerHTML"],[1,"ph-verb"],[1,"lex-unit",3,"innerHTML"],[1,"term-extra"],[1,"transcription",3,"innerHTML"],[1,"freq"],[1,"definition",3,"innerHTML"],[1,"translation",3,"innerHTML"],[1,"next-reviews"],[1,"normal"]],template:function(e,n){if(e&1&&(S(0,J,5,1,"div",0)(1,te,18,13,"div",1),r(2,"div",2)(3,"div",3)(4,"a",4),s(5," Home "),a(),r(6,"a",5),s(7," Viewer "),a(),r(8,"span",6),s(9," Space - show extra, 1-again, 2-hard, 3 (or enter) -normal, 4-ease. "),C(10,"br"),r(11,"span"),s(12),a(),s(13," | R - replay sound. z - restore. ForgetCard - 0. "),a()()()),e&2){let d;k(n.ankiCard()?-1:0),i(),k(n.ankiCard()?1:-1),i(5),m("routerLink","/"+n.UrlsEnum.Viewer),i(6),u(" Deck: ",(d=n.ankiCard())==null?null:d.deckName," ")}},dependencies:[z,K],styles:["[_nghost-%COMP%]{box-sizing:border-box;display:flex;flex-direction:column;height:100%;margin:0 auto;max-width:1200px;padding:24px}.bottom[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:column;gap:8px}.bottom[_ngcontent-%COMP%]   .bottom-line[_ngcontent-%COMP%]{display:flex;gap:8px}.card[_ngcontent-%COMP%]{align-items:center;display:flex;flex:1;flex-direction:column;gap:16px;justify-content:flex-start}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]{align-items:baseline;display:flex;font-size:24px;gap:16px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type[_ngcontent-%COMP%]{font-size:14px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type.review[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]{color:#00f}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .pos[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{color:#00f;font-size:24px}.card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{color:#8b0000}.card[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{font-size:24px}.card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]{border:1px solid gray;display:flex;font-size:24px;gap:16px;padding:4px 8px}.next-reviews.review[_ngcontent-%COMP%]{border:1px solid darkred;outline:1px solid darkred}.next-reviews[_ngcontent-%COMP%]   .normal[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]   .was-last[_ngcontent-%COMP%]{text-decoration:underline}.ph-verb[_ngcontent-%COMP%]{color:#00008b}.lex-unit[_ngcontent-%COMP%]{color:#8b0000}.cards-number[_ngcontent-%COMP%], .timer-counter[_ngcontent-%COMP%]{color:#8b008b}.timer-block[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:green}"]})};export{G as LearnComponent};
