import{a as D}from"./chunk-BUG2RXMT.js";import{c as B,d as N,f as K}from"./chunk-DHXJL7K2.js";import"./chunk-6TPRDAXS.js";import{a as q,b as V}from"./chunk-R5FB43CF.js";import"./chunk-5H7V54M7.js";import"./chunk-WIZ6UHY7.js";import{a as z}from"./chunk-5K5SMW74.js";import{Ca as r,Da as a,Ea as h,I as O,Ia as g,Sa as d,Ua as p,Va as E,Y as m,ab as A,bb as H,da as k,ea as i,ia as P,ma as I,ra as S,s as M,u as w,va as x,wa as y,wb as R,ya as v}from"./chunk-U47C5U2E.js";var U=(l,t)=>l.type!==t.type?l.type-t.type:l.due-t.due;var F={ShowExtraInfo:[" "],LearnAgain:["1"],SetHard:["2"],SetNormal:["3","enter"],SetEasy:["4"],StartTimer:["8"],StopTimer:["9"],ReplayAudio:["r","\u043A"],RestoreLastCard:["z","\u044F"]};function C(l,t){return F[l].includes(t)}function $(l,t){if(l&1&&(r(0,"div",0)(1,"a",6),d(2," Viewer "),a(),h(3,"br")(4,"br"),a()),l&2){let e=g();i(),x("routerLink","/"+e.UrlsEnum.Viewer)}}function G(l,t){if(l&1&&(r(0,"span",8)(1,"span",16),d(2),a(),r(3,"span",17),d(4),a()()),l&2){let e=g(2);i(2),p(" ",e.timerCounter()," "),i(2),p(" ",e.timerTimeMin()," ")}}function J(l,t){if(l&1&&(r(0,"span",18),d(1),a()),l&2){let e,n=g(3);i(),p(" ",(e=n.ankiCard())==null||e.fields==null||e.fields.phVerb==null?null:e.fields.phVerb.value," ")}}function Q(l,t){if(l&1&&h(0,"span",19),l&2){let e,n=g(3);x("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.lexunit==null?null:e.fields.lexunit.value,k)}}function W(l,t){if(l&1&&(r(0,"div",14),S(1,J,2,1,"span",18)(2,Q,1,1,"span",19),a()),l&2){let e,n,s=g(2);i(),v(!((e=s.ankiCard())==null||e.fields==null||e.fields.phVerb==null)&&e.fields.phVerb.value?1:-1),i(),v(!((n=s.ankiCard())==null||n.fields==null||n.fields.lexunit==null)&&n.fields.lexunit.value?2:-1)}}function X(l,t){if(l&1&&h(0,"div",24),l&2){let e,n=g(3);x("innerHTML",(e=n.ankiCard())==null||e.fields==null||e.fields.translation==null?null:e.fields.translation.value,k)}}function Y(l,t){if(l&1&&(r(0,"div",20),h(1,"span",21),A(2,"transcription"),r(3,"span",22)(4,"span"),d(5),a(),r(6,"span"),d(7),a()()(),h(8,"div",23),S(9,X,1,1,"div",24),r(10,"div",25)(11,"span"),d(12),a(),r(13,"span"),d(14),a(),r(15,"span",26),d(16),a(),r(17,"span"),d(18),a()()),l&2){let e,n,s,f,_,u,b,o,L,T,c=g(2);i(),x("innerHTML",H(2,19,(e=c.ankiCard())==null||e.fields==null||e.fields.transcription==null?null:e.fields.transcription.value),k),i(4),p(" ",(n=c.ankiCard())==null||n.fields==null||n.fields.freq==null?null:n.fields.freq.value," "),i(2),p(" ",(s=c.ankiCard())==null||s.fields==null||s.fields.freq2==null?null:s.fields.freq2.value," "),i(),x("innerHTML",(f=c.ankiCard())==null||f.fields==null||f.fields.def==null?null:f.fields.def.value,k),i(),v(!((_=c.ankiCard())==null||_.fields==null||_.fields.translation==null)&&_.fields.translation.value?9:-1),i(),y("review",c.ankiCardTypes[((u=c.ankiCard())==null?null:u.type)||9]==="review"),i(),y("was-last",c.lastAnswer()===1),i(),p("",(b=c.ankiCard())==null||b.nextReviews==null?null:b.nextReviews[0]," "),i(),y("was-last",c.lastAnswer()===2),i(),p("",(o=c.ankiCard())==null||o.nextReviews==null?null:o.nextReviews[1]," "),i(),y("was-last",c.lastAnswer()===3),i(),p("",(L=c.ankiCard())==null||L.nextReviews==null?null:L.nextReviews[2]," "),i(),y("was-last",c.lastAnswer()===4),i(),p("",(T=c.ankiCard())==null||T.nextReviews==null?null:T.nextReviews[3]," ")}}function Z(l,t){if(l&1&&(r(0,"div",1)(1,"div",7),S(2,G,5,2,"span",8),r(3,"span",9),d(4),a(),r(5,"span",10),d(6),a(),h(7,"span",11),r(8,"span",12),d(9),a(),h(10,"span",13),S(11,W,3,2,"div",14),a(),h(12,"div",15),S(13,Y,19,21),a()),l&2){let e,n,s,f,_,u,b,o=g();i(2),v(o.timerIsOn()?2:-1),i(2),E(" ",o.learningCardsNumber()," : ",o.cardsNumber()," "),i(),y("review",o.ankiCardTypes[((e=o.ankiCard())==null?null:e.type)||9]==="review"),i(),p(" ",o.ankiCardTypes[((n=o.ankiCard())==null?null:n.type)||9]," : "),i(),x("innerHTML",(s=o.ankiCard())==null||s.fields==null||s.fields.term==null?null:s.fields.term.value,k),i(2),p(" (",(f=o.ankiCard())==null||f.fields==null||f.fields.pos==null?null:f.fields.pos.value,") "),i(),x("innerHTML",(_=o.ankiCard())==null||_.fields==null||_.fields.registerlab==null?null:_.fields.registerlab.value,k),i(),v(!((u=o.ankiCard())==null||u.fields==null||u.fields.phVerb==null)&&u.fields.phVerb.value||!((u=o.ankiCard())==null||u.fields==null||u.fields.lexunit==null)&&u.fields.lexunit.value?11:-1),i(),x("innerHTML",(b=o.ankiCard())==null||b.fields==null||b.fields.exampleText==null?null:b.fields.exampleText.value,k),i(),v(o.showBackSide()?13:-1)}}var j=class l{constructor(t){this.ankiConnectService=t}isLoading=m(!1);ankiCard=m(null);cardsNumber=m(0);learningCardsNumber=m(0);showBackSide=m(!0);lastAnswer=m(0);timerIsOn=m(!1);timerCounter=m(0);timerTimeMin=m(0);timerBaseTimeMs=0;UrlsEnum=z;ankiCardTypes=B;hotKeysService=O(D);hotKeysServiceSubscription;htmLAudioElement=null;lastCardId=0;ngOnInit(){this.getCard(),this.takeHotKey(),this.switchTimer(!0)}ngOnDestroy(){this.hotKeysServiceSubscription?.unsubscribe()}getCard(){let e=`deck:${localStorage.getItem(V.key)||"cald"} is:due`;this.isLoading.set(!0),this.showBackSide.set(!1),this.ankiConnectService.findCards(e).pipe(M(1),w(()=>{this.isLoading.set(!1)})).subscribe(n=>{console.log(n.slice(0,50)),this.stopAudio(),n.sort(U),this.ankiCard.set(n[0]||null),this.cardsNumber.set(n.length),this.learningCardsNumber.set(n.filter(s=>s.type===1).length),window.scrollTo(0,0),this.initAudio()})}getCardById(t){t&&(this.isLoading.set(!0),this.showBackSide.set(!1),this.ankiConnectService.getCardById(t).pipe(M(1),w(()=>{this.isLoading.set(!1)})).subscribe(e=>{this.stopAudio(),this.ankiCard.set(e||null),this.cardsNumber.set(0),this.learningCardsNumber.set(0),window.scrollTo(0,0),this.initAudio()}))}takeHotKey(){this.hotKeysServiceSubscription=this.hotKeysService.hotKeyEvent.subscribe(t=>{switch(!0){case C("ShowExtraInfo",t):this.showBackSide.set(!0),this.replayAudio();break;case C("LearnAgain",t):this.answerCard(1);break;case C("SetHard",t):this.answerCard(2);break;case C("SetNormal",t):this.answerCard(3);break;case C("SetEasy",t):this.answerCard(4);break;case C("ReplayAudio",t):this.replayAudio();break;case C("StartTimer",t):this.switchTimer(!0);break;case C("StopTimer",t):this.switchTimer(!1);break;case C("RestoreLastCard",t):this.restoreLastCard();break}})}answerCard(t){if(!this.showBackSide())return;this.isLoading.set(!0);let e=this.ankiCard()?.cardId;e&&this.ankiConnectService.answerCardsByIds([e],t).pipe(M(1),w(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.lastCardId=e,this.increaseTimer(),this.lastAnswer.set(t),this.getCard()})}initAudio(){let t=this.ankiCard()?.fields?.sound?.value;if(this.htmLAudioElement=null,!t)return;let e=t.replaceAll("[sound:","").replaceAll("]","").trim(),n=localStorage.getItem(q.key);!e||!n||(this.htmLAudioElement=new Audio(n+e),this.htmLAudioElement.play())}replayAudio(){this.htmLAudioElement?.play()}stopAudio(){this.htmLAudioElement?.pause()}switchTimer(t){this.timerIsOn.set(t),this.timerCounter.set(0),this.timerTimeMin.set(0),t?this.timerBaseTimeMs=Date.now():this.timerBaseTimeMs=0}increaseTimer(){if(!this.timerIsOn())return;this.timerCounter.update(n=>n+1);let t=Math.round((Date.now()-this.timerBaseTimeMs)/1e3),e=Math.floor(t/60);this.timerTimeMin.set(e)}restoreLastCard(){this.lastCardId&&this.ankiConnectService.answerCardsByIds([this.lastCardId],1).pipe(M(1),w(()=>{this.isLoading.set(!1)})).subscribe(()=>{this.getCardById(this.lastCardId)})}static \u0275fac=function(e){return new(e||l)(P(K))};static \u0275cmp=I({type:l,selectors:[["app-learn"]],decls:10,vars:3,consts:[[1,"empty-block"],[1,"card"],[1,"bottom"],[1,"bottom-line"],["routerLink","/"],[1,"hints"],[3,"routerLink"],[1,"term-block"],[1,"timer-block"],[1,"cards-number"],[1,"card-type"],[1,"term",3,"innerHTML"],[1,"pos"],[1,"register-lab",3,"innerHTML"],[1,"lex-unit"],[1,"example",3,"innerHTML"],[1,"timer-counter"],[1,"timer-value"],[1,"ph-verb"],[1,"lex-unit",3,"innerHTML"],[1,"term-extra"],[1,"transcription",3,"innerHTML"],[1,"freq"],[1,"definition",3,"innerHTML"],[1,"translation",3,"innerHTML"],[1,"next-reviews"],[1,"normal"]],template:function(e,n){if(e&1&&(S(0,$,5,1,"div",0)(1,Z,14,12,"div",1),r(2,"div",2)(3,"div",3)(4,"a",4),d(5," Home "),a(),r(6,"span"),d(7),a(),r(8,"span",5),d(9," | Space - show extra, 1-again, 2-hard, 3 (or enter) -normal, 4-ease. R - replay sound. z - restore. "),a()()()),e&2){let s;v(n.ankiCard()?-1:0),i(),v(n.ankiCard()?1:-1),i(6),p(" Deck: ",(s=n.ankiCard())==null?null:s.deckName," ")}},dependencies:[R,N],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;margin:0 auto;max-width:1200px;padding:24px;height:100%;box-sizing:border-box}.bottom[_ngcontent-%COMP%]{align-items:center;display:flex;flex-direction:column;gap:8px;margin-bottom:24px}.bottom[_ngcontent-%COMP%]   .bottom-line[_ngcontent-%COMP%]{display:flex;gap:8px}.card[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column;align-items:center;justify-content:flex-start;gap:16px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]{display:flex;font-size:24px;gap:16px;align-items:baseline}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type[_ngcontent-%COMP%]{font-size:14px}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .card-type.review[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .term[_ngcontent-%COMP%]{color:#00f}.card[_ngcontent-%COMP%]   .term-block[_ngcontent-%COMP%]   .pos[_ngcontent-%COMP%]{color:green}.card[_ngcontent-%COMP%]   .transcription[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{font-size:24px;color:#00f}.card[_ngcontent-%COMP%]   .freq[_ngcontent-%COMP%]{color:#8b0000}.card[_ngcontent-%COMP%]   .example[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .definition[_ngcontent-%COMP%], .card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{font-size:24px}.card[_ngcontent-%COMP%]   .translation[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]{display:flex;gap:16px;font-size:24px;padding:4px 8px;border:1px solid gray}.next-reviews.review[_ngcontent-%COMP%]{border:1px solid darkred;outline:1px solid darkred}.next-reviews[_ngcontent-%COMP%]   .normal[_ngcontent-%COMP%]{color:green}.next-reviews[_ngcontent-%COMP%]   .was-last[_ngcontent-%COMP%]{text-decoration:underline}.ph-verb[_ngcontent-%COMP%]{color:#00008b}.lex-unit[_ngcontent-%COMP%]{color:#8b0000}.cards-number[_ngcontent-%COMP%], .timer-counter[_ngcontent-%COMP%]{color:#8b008b}.timer-block[_ngcontent-%COMP%]   .timer-value[_ngcontent-%COMP%]{color:green}"]})};export{j as LearnComponent};
